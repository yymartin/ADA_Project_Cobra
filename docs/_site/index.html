<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">

  <title>A time Story of offshore Societies</title>

  <meta name="author" content="Pierre Latécoère, Simon Roquette and Yoan Martin" />

  

  <link rel="alternate" type="application/rss+xml" title="ADA_Project_Cobra - " href="/ADA_Project_Cobra//feed.xml" />

  

  
  

  
    
      
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />

    
  

  
    
      <link rel="stylesheet" href="/ADA_Project_Cobra/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/ADA_Project_Cobra/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/ADA_Project_Cobra/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="A time Story of offshore Societies" />
  

   
  <meta property="og:description" content="# A time Story of offshore Societies You can see the aim of this project in the README file. Our work is based on 4 databases, namely the *bahamas leaks*, the *panama papers*, the *offshore leaks* and the *paradise papers*. They all contain csv files with all the data of...">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://localhost:4000/" />
  <link rel="canonical" href="http://localhost:4000/" />
  

  
  <meta property="og:image" content="http://localhost:4000/img/avatar-icon.png" />
  


  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />

  
  <meta name="twitter:title" content="A time Story of offshore Societies" />
  

  
  <meta name="twitter:description" content="# A time Story of offshore Societies You can see the aim of this project in the README file. Our work is based on 4 databases, namely the *bahamas leaks*, the *panama papers*, the *offshore leaks* and the *paradise papers*. They all contain csv files with all the data of...">
  

  
  <meta name="twitter:image" content="http://localhost:4000/img/avatar-icon.png" />
  

  

</head>


  <body>

    
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
        <a class="navbar-brand"></a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000 ">
	      <img class="avatar-img" src="/ADA_Project_Cobra/img/avatar-icon.png" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->



<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-heading">
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>

<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      
<h1 id="a-time-story-of-offshore-societies">A time Story of offshore Societies</h1>

<p>You can see the aim of this project in the README file.</p>

<p>Our work is based on 4 databases, namely the <em>bahamas leaks</em>, the <em>panama papers</em>, the <em>offshore leaks</em> and the <em>paradise papers</em>. They all contain csv files with all the data of a graph : nodes (one file for each type of node), and edges. We merged all these files in this notebook.</p>

<p>You will see all the steps of our data exploration. In the end our objective is to arrive to two Dataframe, one containing all the nodes and the relevant information, and one containing the edges with relevant information.</p>

<h2 id="imports">Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="n">nx</span> <span class="c">#For graphs</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">dateutil.parser</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c"># https://www.occrp.org/en/panamapapers/database</span>
<span class="c"># TRUMP OFFSHORE INC. is good example to see all entities interacting</span>
</code></pre></div></div>

<h2 id="filenames--paths">Filenames / paths</h2>

<p>The data is separated for every leak source. For each leak source there is a folder containing the nodes of the graph, that can be of different types : <i>intermediary, officer, entity, address</i> (and <i>other</i> for paradise papers only). The folder also contains the edges of this graph.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bahamas_folder</span> <span class="o">=</span> <span class="s">"bahamas/"</span>
<span class="n">panama_folder</span> <span class="o">=</span> <span class="s">"panama/"</span>
<span class="n">paradise_folder</span> <span class="o">=</span> <span class="s">"paradise/"</span>
<span class="n">offshore_folder</span> <span class="o">=</span> <span class="s">"offshore/"</span>

<span class="n">sources_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'bahamas'</span><span class="p">,</span> <span class="s">'panama'</span><span class="p">,</span> <span class="s">'paradise'</span><span class="p">,</span> <span class="s">'offshore'</span><span class="p">]</span>

<span class="n">panama_name</span> <span class="o">=</span> <span class="n">panama_folder</span> <span class="o">+</span> <span class="s">"panama_papers"</span>
<span class="n">paradise_name</span> <span class="o">=</span> <span class="n">paradise_folder</span> <span class="o">+</span> <span class="s">"paradise_papers"</span>
<span class="n">offshore_name</span> <span class="o">=</span> <span class="n">offshore_folder</span> <span class="o">+</span> <span class="s">"offshore_leaks"</span>
<span class="n">bahamas_name</span> <span class="o">=</span> <span class="n">bahamas_folder</span> <span class="o">+</span> <span class="s">"bahamas_leaks"</span>

<span class="n">edges_name</span> <span class="o">=</span> <span class="s">".edges"</span>
<span class="n">nodes_name</span> <span class="o">=</span> <span class="s">".nodes."</span>

<span class="n">address_name</span> <span class="o">=</span> <span class="s">"address"</span>
<span class="n">intermediary_name</span> <span class="o">=</span> <span class="s">"intermediary"</span>
<span class="n">officer_name</span> <span class="o">=</span> <span class="s">"officer"</span>
<span class="n">entity_name</span> <span class="o">=</span> <span class="s">"entity"</span>
<span class="n">others_name</span> <span class="o">=</span> <span class="s">"other"</span> <span class="c"># Only for paradise paper there is this extra entity</span>

<span class="n">usual_entity_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">address_name</span><span class="p">,</span> <span class="n">intermediary_name</span><span class="p">,</span> <span class="n">officer_name</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="build-local-storage">Build local storage</h2>

<p>We store data in dictionnaries that map each leak source to its content, which is a dictionnary that maps each type of entity to the Dataframe containing its values. For example <b>d_sources[“bahamas”][“officer”]</b> is the Dataframe of officers coming from the bahamas leaks.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="p">:</span>
    <span class="s">""" To have same rules when reading data from csv """</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">build_dict</span><span class="p">(</span><span class="n">source_name</span><span class="p">):</span>
    <span class="s">"""
    Create a dictionnary for a certain source_name (among : Panama papers, Paradise papers...)
    that maps to each entity name (among : Officer, Intermediary, Address...)
    the content of the csv from source_name for this entity
    """</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">en</span> <span class="p">:</span> <span class="n">my_read_csv</span><span class="p">(</span><span class="n">source_name</span> <span class="o">+</span> <span class="n">nodes_name</span> <span class="o">+</span> <span class="n">en</span> <span class="o">+</span> <span class="s">".csv"</span><span class="p">)</span> <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">}</span>
    
    <span class="k">if</span> <span class="n">source_name</span> <span class="o">==</span> <span class="n">paradise_name</span><span class="p">:</span> <span class="c"># Extra "other" entity in paradise papers</span>
        <span class="n">d</span><span class="p">[</span><span class="n">others_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_read_csv</span><span class="p">(</span><span class="n">source_name</span> <span class="o">+</span> <span class="n">nodes_name</span> <span class="o">+</span> <span class="n">others_name</span> <span class="o">+</span> <span class="s">".csv"</span><span class="p">)</span>
    
    <span class="c">#Add edges</span>
    <span class="n">d</span><span class="p">[</span><span class="s">"edges"</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_read_csv</span><span class="p">(</span><span class="n">source_name</span> <span class="o">+</span> <span class="n">edges_name</span> <span class="o">+</span> <span class="s">".csv"</span><span class="p">)</span>
              
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></div>

<p>Build the dictionnary, that maps each source to its content</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d_sources</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">d_sources</span><span class="p">[</span><span class="s">"bahamas"</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_dict</span><span class="p">(</span><span class="n">bahamas_name</span><span class="p">)</span>
<span class="n">d_sources</span><span class="p">[</span><span class="s">"panama"</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_dict</span><span class="p">(</span><span class="n">panama_name</span><span class="p">)</span>
<span class="n">d_sources</span><span class="p">[</span><span class="s">"paradise"</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_dict</span><span class="p">(</span><span class="n">paradise_name</span><span class="p">)</span>
<span class="n">d_sources</span><span class="p">[</span><span class="s">"offshore"</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_dict</span><span class="p">(</span><span class="n">offshore_name</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d_sources</span><span class="p">[</span><span class="s">'panama'</span><span class="p">][</span><span class="s">'entity'</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['node_id', 'name', 'jurisdiction', 'jurisdiction_description',
       'country_codes', 'countries', 'incorporation_date', 'inactivation_date',
       'struck_off_date', 'closed_date', 'ibcRUC', 'status', 'company_type',
       'service_provider', 'sourceID', 'valid_until', 'note'],
      dtype='object')
</code></pre></div></div>

<h2 id="getting-familiar-with-the-data-format">Getting familiar with the data format</h2>

<h3 id="define-some-coloring-for-printing">Define some coloring for printing</h3>

<p>Keep the same coloring during the project, it makes data very easily readable once you get familiar with the coloring !</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BOLD</span> <span class="o">=</span> <span class="s">'</span><span class="se">\033</span><span class="s">[1m'</span>
<span class="n">BLUE</span> <span class="o">=</span> <span class="s">'</span><span class="se">\033</span><span class="s">[94m'</span>
<span class="n">GREEN</span> <span class="o">=</span> <span class="s">'</span><span class="se">\033</span><span class="s">[92m'</span>
<span class="n">YELLOW</span> <span class="o">=</span> <span class="s">'</span><span class="se">\033</span><span class="s">[93m'</span>
<span class="n">RED</span> <span class="o">=</span> <span class="s">'</span><span class="se">\033</span><span class="s">[91m'</span>
<span class="n">END</span> <span class="o">=</span> <span class="s">'</span><span class="se">\033</span><span class="s">[0m'</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">color_dict</span><span class="p">[</span><span class="s">"bahamas"</span><span class="p">]</span> <span class="o">=</span> <span class="n">YELLOW</span>
<span class="n">color_dict</span><span class="p">[</span><span class="s">"paradise"</span><span class="p">]</span> <span class="o">=</span> <span class="n">GREEN</span>
<span class="n">color_dict</span><span class="p">[</span><span class="s">"panama"</span><span class="p">]</span> <span class="o">=</span> <span class="n">RED</span>
<span class="n">color_dict</span><span class="p">[</span><span class="s">"offshore"</span><span class="p">]</span> <span class="o">=</span> <span class="n">BLUE</span>

<span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="s">"""
    Returns the str given in the color of the source it is from 
    (the str must contain source name)
    """</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">color_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">color_dict</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span> <span class="o">+</span> <span class="n">END</span> 
        
    <span class="k">return</span> <span class="n">BOLD</span> <span class="o">+</span> <span class="nb">str</span> <span class="o">+</span> <span class="n">END</span> <span class="c">#Default color is BOLD</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">color_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="s">"Unknown source"</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[93mbahamas[0m
[92mparadise[0m
[91mpanama[0m
[94moffshore[0m
[1mUnknown source[0m
</code></pre></div></div>

<h3 id="see-what-data-source-misses-which-column">See what data source misses which column</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">dict_data</span> <span class="ow">in</span> <span class="n">d_sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">source_compare</span><span class="p">,</span> <span class="n">dict_data_compare</span> <span class="ow">in</span> <span class="n">d_sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">source_compare</span><span class="p">),</span> <span class="s">"missing columns from source :"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">:</span>
            <span class="n">missing_columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dict_data</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dict_data_compare</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">missing_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Node type"</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="s">"misses"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_columns</span><span class="p">),</span> <span class="s">"columns, namely : "</span><span class="p">,</span> <span class="n">missing_columns</span><span class="p">)</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [93mbahamas[0m missing columns from source : [93mbahamas[0m

 [91mpanama[0m missing columns from source : [93mbahamas[0m
Node type address misses 10 columns, namely :  ['labels(n)', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'status', 'company_type']
Node type intermediary misses 10 columns, namely :  ['labels(n)', 'address', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'company_type']
Node type officer misses 11 columns, namely :  ['labels(n)', 'address', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'status', 'company_type']
Node type entity misses 3 columns, namely :  ['labels(n)', 'address', 'type']

 [92mparadise[0m missing columns from source : [93mbahamas[0m
Node type address misses 10 columns, namely :  ['labels(n)', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'status', 'company_type']
Node type intermediary misses 11 columns, namely :  ['labels(n)', 'address', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'status', 'company_type']
Node type officer misses 10 columns, namely :  ['labels(n)', 'address', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'company_type']
Node type entity misses 3 columns, namely :  ['labels(n)', 'address', 'type']

 [94moffshore[0m missing columns from source : [93mbahamas[0m
Node type address misses 10 columns, namely :  ['labels(n)', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'status', 'company_type']
Node type intermediary misses 10 columns, namely :  ['labels(n)', 'address', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'company_type']
Node type officer misses 11 columns, namely :  ['labels(n)', 'address', 'jurisdiction_description', 'service_provider', 'jurisdiction', 'closed_date', 'incorporation_date', 'ibcRUC', 'type', 'status', 'company_type']
Node type entity misses 3 columns, namely :  ['labels(n)', 'address', 'type']

 [93mbahamas[0m missing columns from source : [91mpanama[0m
Node type entity misses 2 columns, namely :  ['inactivation_date', 'struck_off_date']

 [91mpanama[0m missing columns from source : [91mpanama[0m

 [92mparadise[0m missing columns from source : [91mpanama[0m
Node type intermediary misses 1 columns, namely :  ['status']

 [94moffshore[0m missing columns from source : [91mpanama[0m

 [93mbahamas[0m missing columns from source : [92mparadise[0m
Node type entity misses 2 columns, namely :  ['inactivation_date', 'struck_off_date']

 [91mpanama[0m missing columns from source : [92mparadise[0m
Node type officer misses 1 columns, namely :  ['status']

 [92mparadise[0m missing columns from source : [92mparadise[0m

 [94moffshore[0m missing columns from source : [92mparadise[0m
Node type officer misses 1 columns, namely :  ['status']

 [93mbahamas[0m missing columns from source : [94moffshore[0m
Node type entity misses 2 columns, namely :  ['inactivation_date', 'struck_off_date']

 [91mpanama[0m missing columns from source : [94moffshore[0m

 [92mparadise[0m missing columns from source : [94moffshore[0m
Node type intermediary misses 1 columns, namely :  ['status']

 [94moffshore[0m missing columns from source : [94moffshore[0m
</code></pre></div></div>

<p>We see that <span style="color:orange">bahamas</span> is the most “complete” source, in the sense it is the one that has the biggest number of columns missing in the others. We will therefore use it to explore the content of columns. <em>‘inactivation_date’</em> and  <em>‘struck_off_date’</em> columns from entity will then be explored in <span style="color:red">panama</span></p>

<h4 id="special-case--paradise-paper-other-node">Special case : Paradise paper, <i>other</i> node</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d_sources</span><span class="p">[</span><span class="s">"paradise"</span><span class="p">][</span><span class="s">"other"</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['node_id', 'name', 'country_codes', 'countries', 'sourceID',
       'valid_until', 'note'],
      dtype='object')
</code></pre></div></div>

<h3 id="sourceid-in-different-sources">SourceID in different sources</h3>

<p>We see paradise papers is the only source that has different sourceID</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">dict_data</span> <span class="ow">in</span> <span class="n">d_sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Source :"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">:</span>
        <span class="n">value_count</span> <span class="o">=</span>  <span class="n">dict_data</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s">"sourceID"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Node :"</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_count</span><span class="p">),</span> <span class="s">"different sourceID :"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Source : [93mbahamas[0m
Node : address 1 different sourceID :
Node : intermediary 1 different sourceID :
Node : officer 1 different sourceID :
Node : entity 1 different sourceID :

Source : [91mpanama[0m
Node : address 1 different sourceID :
Node : intermediary 1 different sourceID :
Node : officer 1 different sourceID :
Node : entity 1 different sourceID :

Source : [92mparadise[0m
Node : address 7 different sourceID :
Node : intermediary 5 different sourceID :
Node : officer 9 different sourceID :
Node : entity 9 different sourceID :

Source : [94moffshore[0m
Node : address 1 different sourceID :
Node : intermediary 1 different sourceID :
Node : officer 1 different sourceID :
Node : entity 1 different sourceID :
</code></pre></div></div>

<h3 id="check-if-node_id-is-a-good-index-for-nodes">Check if node_id is a good index for Nodes</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">merged_node_id</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">dict_data</span> <span class="ow">in</span> <span class="n">d_sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">merged_node_id_source</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">:</span>
        
        <span class="n">merged_node_id_source</span> <span class="o">=</span> <span class="n">merged_node_id_source</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_data</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s">"node_id"</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dict_data</span><span class="p">[</span><span class="n">entity</span><span class="p">][</span><span class="s">"node_id"</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"node_id isn't unique for source"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">"node"</span><span class="p">,</span> <span class="n">entity</span><span class="p">))</span>
                  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">merged_node_id_source</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"node_id isn't unique between nodes from source"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
    
    <span class="n">merged_node_id</span> <span class="o">=</span> <span class="n">merged_node_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_node_id_source</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())</span>

<span class="k">if</span> <span class="n">merged_node_id</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"node_id is unique between unique nodes from all sources"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_id isn't unique between nodes from source [94moffshore[0m
node_id is unique between unique nodes from all sources
</code></pre></div></div>

<p>So for each node type indepently node_id is a good index. Therefore (node_id, node_type) could be a good index (node_type being amond officer, intermediary…)</p>

<p>Now explore nodes with same node_id in offshore</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">usual_entity_names</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">usual_entity_names</span><span class="p">)):</span>

        <span class="n">left_node</span> <span class="o">=</span> <span class="n">usual_entity_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">usual_entity_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="n">color</span><span class="p">(</span><span class="n">left_node</span><span class="p">),</span> <span class="n">color</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">left_node</span> <span class="o">!=</span> <span class="n">node</span><span class="p">:</span>

            <span class="n">left</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="s">"offshore"</span><span class="p">][</span><span class="n">left_node</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"node_id"</span><span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="s">"offshore"</span><span class="p">][</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"node_id"</span><span class="p">)</span>

            <span class="n">intersection</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s">"node_id"</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s">'inner'</span><span class="p">,</span> \
                                     <span class="n">lsuffix</span> <span class="o">=</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">left_node</span><span class="p">,</span><span class="n">rsuffix</span> <span class="o">=</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">node</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">intersection</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Intersection of"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">left_node</span><span class="p">),</span> <span class="s">"and"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="s">"count is :"</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">intersection</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1maddress[0m [1mintermediary[0m
[1maddress[0m [1mofficer[0m
[1maddress[0m [1mentity[0m
[1mintermediary[0m [1mofficer[0m
Intersection of [1mintermediary[0m and [1mofficer[0m count is :
name_intermediary             1139
country_codes_intermediary    1139
countries_intermediary        1139
status                           0
sourceID_intermediary         1139
valid_until_intermediary      1139
note_intermediary                0
name_officer                  1139
country_codes_officer         1139
countries_officer             1139
sourceID_officer              1139
valid_until_officer           1139
note_officer                     0
dtype: int64
[1mintermediary[0m [1mentity[0m
[1mofficer[0m [1mentity[0m
</code></pre></div></div>

<p>So the intersection on offshore is between officer and intermediary nodes. Let’s see if they are the same values :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">left</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="s">"offshore"</span><span class="p">][</span><span class="s">"officer"</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"node_id"</span><span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="s">"offshore"</span><span class="p">][</span><span class="s">"intermediary"</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">"node_id"</span><span class="p">)</span>

<span class="n">intersection</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s">"node_id"</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s">'inner'</span><span class="p">,</span> <span class="n">lsuffix</span> <span class="o">=</span> <span class="s">"_officer"</span><span class="p">,</span><span class="n">rsuffix</span> <span class="o">=</span> <span class="s">"_interm"</span><span class="p">)</span>

<span class="n">intersection</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">intersection</span><span class="p">[</span><span class="s">"name_officer"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">intersection</span><span class="p">[</span><span class="s">"name_interm"</span><span class="p">]]</span><span class="o">.</span><span class="n">empty</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True
</code></pre></div></div>

<p>Therefore we understand that if someone appears in two different node types, it means it is the same person, but has two roles. This is why in further analysis we will store the pair (node_id, role) as index, because it is unique. We have to add a column to nodes, containing the node type, let’s call it label. We saw in the column exploration that bahamas has an equivalent column <em>labels(n)</em>, that the other’s don’t, we’ll rename it to <em>label</em></p>

<h2 id="keep-necessary-columns-shape-data-to-our-need">Keep necessary columns, Shape data to our need</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d_clean</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c">#maps every node type to the columns to keep</span>
<span class="n">d_columns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">d_columns</span><span class="p">[</span><span class="s">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'country_codes'</span><span class="p">,</span> <span class="s">'node_id'</span><span class="p">]</span>
<span class="n">d_columns</span><span class="p">[</span><span class="s">'entity'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'node_id'</span><span class="p">,</span><span class="s">'name'</span><span class="p">,</span><span class="s">'jurisdiction'</span><span class="p">,</span><span class="s">'incorporation_date'</span><span class="p">]</span>
<span class="n">d_columns</span><span class="p">[</span><span class="s">'intermediary'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'node_id'</span><span class="p">,</span> <span class="s">'country_codes'</span><span class="p">,</span><span class="s">'name'</span><span class="p">]</span>
<span class="n">d_columns</span><span class="p">[</span><span class="s">'officer'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'node_id'</span><span class="p">,</span> <span class="s">'country_codes'</span><span class="p">,</span><span class="s">'name'</span><span class="p">]</span>
<span class="n">d_columns</span><span class="p">[</span><span class="s">'other'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">'node_id'</span><span class="p">,</span> <span class="s">'country_codes'</span><span class="p">,</span><span class="s">'name'</span><span class="p">]</span>


<span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    
    <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">node_type</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">:</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">node_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">node_type</span><span class="p">][</span><span class="n">d_columns</span><span class="p">[</span><span class="n">node_type</span><span class="p">]]</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">node_type</span><span class="p">][</span><span class="s">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">node_type</span><span class="p">][</span><span class="s">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_type</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">node_type</span><span class="p">][</span><span class="s">'node_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">node_type</span><span class="p">][</span><span class="s">'node_id'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    
    <span class="n">columns_edges</span> <span class="o">=</span> <span class="p">[</span><span class="s">'START_ID'</span><span class="p">,</span> <span class="s">'END_ID'</span><span class="p">,</span> <span class="s">'TYPE'</span><span class="p">,</span> <span class="s">'start_date'</span><span class="p">,</span> <span class="s">'end_date'</span><span class="p">]</span>        
    <span class="n">columns_edges_bahamas</span> <span class="o">=</span> <span class="p">[</span><span class="s">'node_1'</span><span class="p">,</span> <span class="s">'node_2'</span><span class="p">,</span> <span class="s">'rel_type'</span><span class="p">,</span> <span class="s">'start_date'</span><span class="p">,</span> <span class="s">'end_date'</span><span class="p">]</span>    
    
    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">"bahamas"</span><span class="p">:</span> <span class="c"># adapt different column names</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="n">columns_edges_bahamas</span><span class="p">]</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns_edges</span>
        
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="n">columns_edges</span><span class="p">]</span>
    
    <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="s">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
    <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="s">"START_ID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="s">"START_ID"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="s">"END_ID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">][</span><span class="s">"END_ID"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> 

<span class="n">d_clean</span><span class="p">[</span><span class="s">'paradise'</span><span class="p">][</span><span class="s">'other'</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_sources</span><span class="p">[</span><span class="s">'paradise'</span><span class="p">][</span><span class="s">'other'</span><span class="p">][</span><span class="n">d_columns</span><span class="p">[</span><span class="s">'other'</span><span class="p">]]</span>
<span class="n">d_clean</span><span class="p">[</span><span class="s">"paradise"</span><span class="p">][</span><span class="s">'other'</span><span class="p">][</span><span class="s">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'paradise'</span>
<span class="n">d_clean</span><span class="p">[</span><span class="s">"paradise"</span><span class="p">][</span><span class="s">'other'</span><span class="p">][</span><span class="s">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'other'</span>
</code></pre></div></div>

<h3 id="create-dictionaries-for-countries-and-jurisdictions">Create dictionaries for countries and jurisdictions</h3>

<p>These dictionaries map the abrevation of countries to their full name, this way we can drop the longer column</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">countries</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">jurisdictions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sources_names</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">:</span>
        <span class="n">countries</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_sources</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="s">'country_codes'</span><span class="p">],</span> <span class="n">d_sources</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="s">'countries'</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">t</span>  <span class="o">==</span> <span class="s">'entity'</span><span class="p">:</span>
            <span class="n">jurisdictions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_sources</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="s">'jurisdiction'</span><span class="p">],</span> <span class="n">d_sources</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="s">'jurisdiction_description'</span><span class="p">])))</span>
            
<span class="n">countries</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_sources</span><span class="p">[</span><span class="s">'paradise'</span><span class="p">][</span><span class="s">'other'</span><span class="p">][</span><span class="s">'country_codes'</span><span class="p">],</span>\
                          <span class="n">d_sources</span><span class="p">[</span><span class="s">'paradise'</span><span class="p">][</span><span class="s">'other'</span><span class="p">][</span><span class="s">'countries'</span><span class="p">])))</span>
</code></pre></div></div>

<h2 id="create-and-study-node-dataframe">Create and study <em>node</em> dataframe</h2>

<p>A pourcentage function to print pourcentages in a nice way</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pourcentage</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
    <span class="s">""" To print a pourcentage in a nice way and with a given precision"""</span>
    <span class="k">return</span> <span class="n">color</span><span class="p">((</span><span class="s">"</span><span class="si">%</span><span class="s">."</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">"f"</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s">"</span><span class="si">%</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<p>A function to convert string of date to datetime format. There are a LOT of different string formats and we cover most of them. Dates with ambiguity such as 01/03/2001 are treated arbitrarily. (i.e. is this date 1st of March or 3rd of January ?) Indeed the year is generally what matters the most for us.</p>

<p>Years are valid until 2015 at most, and starting in the 1960s according to wikipedia (https://en.wikipedia.org/wiki/Panama_Papers)</p>

<p>When date is clearly an outlier (18/19/2006), it is set to NaN, and printed</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_date</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="s">""" Parsing of the date, read above for more details"""</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">date</span><span class="o">==</span><span class="n">date</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">formatted</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">formatted</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2015</span> <span class="ow">or</span> <span class="n">formatted</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1960</span><span class="p">):</span>
                <span class="n">formatted</span> <span class="o">=</span> <span class="s">'NaN'</span>
            <span class="k">return</span> <span class="n">formatted</span> 
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">'NaN'</span>
</code></pre></div></div>

<h3 id="node-types-that-should-contain-nan-for-each-column-name">Node types that should contain NaN for each column name</h3>

<p>Nodes can have NaN values because of missing data, <b>or</b> because the data doesn’t make sense for this node type. You will here find a list of node types for each column, those are node types that are NaN because of this second reason. For example the jurisdiction for an Officer doesn’t really make sense at first sight… We will however in the future try to cumpute all the jurisdictions an officer is related to using the edges (and many more)</p>

<h5 id="name">name</h5>
<ul>
  <li>Address</li>
</ul>

<h5 id="jurisdiction-and-incorporation_date">jurisdiction and incorporation_date</h5>
<ul>
  <li>Officer</li>
  <li>Other</li>
  <li>Intermediary</li>
  <li>Address</li>
</ul>

<h5 id="country_codes">country_codes</h5>
<ul>
  <li>Entity</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'node_id'</span><span class="p">,</span><span class="s">'source'</span><span class="p">,</span><span class="s">'type'</span><span class="p">,</span><span class="s">'name'</span><span class="p">,</span><span class="s">'country_codes'</span><span class="p">,</span> <span class="s">'jurisdiction'</span><span class="p">,</span> <span class="s">'incorporation_date'</span><span class="p">])</span>

<span class="k">for</span> <span class="n">source</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">d_sources</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">node_type</span> <span class="ow">in</span> <span class="n">usual_entity_names</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">node_type</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
<span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d_clean</span><span class="p">[</span><span class="s">'paradise'</span><span class="p">][</span><span class="s">'other'</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'node_id'</span><span class="p">,</span> <span class="s">'type'</span><span class="p">])</span>

<span class="n">nodes</span><span class="p">[</span><span class="s">'incorporation_date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="s">'incorporation_date'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">parse_date</span><span class="p">)</span>
<span class="n">nodes</span><span class="p">[</span><span class="s">'incorporation_date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s">'incorporation_date'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1909605</td>
      <td>1534558</td>
      <td>697326</td>
      <td>785124</td>
      <td>756095</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>4</td>
      <td>1252082</td>
      <td>3573</td>
      <td>80</td>
      <td>15558</td>
    </tr>
    <tr>
      <th>top</th>
      <td>paradise</td>
      <td>THE BEARER</td>
      <td>CHN</td>
      <td>BAH</td>
      <td>1998-01-02 00:00:00</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>867931</td>
      <td>70871</td>
      <td>69394</td>
      <td>209634</td>
      <td>1368</td>
    </tr>
    <tr>
      <th>first</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1960-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>last</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2015-12-31 00:00:00</td>
    </tr>
  </tbody>
</table>
</div>

<p>It looks like there are a lot of unique country_codes… Indeed we notice some nodes have many country codes separated by a ‘;’</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">country_codes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">country_codes</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">number_multi_country</span> <span class="o">=</span> <span class="n">country_codes</span><span class="p">[</span><span class="n">country_codes</span><span class="o">.</span><span class="nb">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">";"</span><span class="p">)]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">pourcentage</span><span class="p">(</span><span class="n">number_multi_country</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">country_codes</span><span class="p">)),</span> <span class="s">"of nodes with a country_code have a country_code with more than one country"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1m4.02%[0m of nodes with a country_code have a country_code with more than one country
</code></pre></div></div>

<h3 id="study-by-node-type">Study by node type</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">'entity'</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>785124</td>
      <td>785095</td>
      <td>0.0</td>
      <td>785124</td>
      <td>756095</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>4</td>
      <td>754951</td>
      <td>0.0</td>
      <td>80</td>
      <td>15558</td>
    </tr>
    <tr>
      <th>top</th>
      <td>paradise</td>
      <td>DE PALM TOURS N.V. - DE PALM TOURS</td>
      <td>NaN</td>
      <td>BAH</td>
      <td>1998-01-02 00:00:00</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>290086</td>
      <td>19</td>
      <td>NaN</td>
      <td>209634</td>
      <td>1368</td>
    </tr>
    <tr>
      <th>first</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1960-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>last</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2015-12-31 00:00:00</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">'officer'</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>720862</td>
      <td>720800</td>
      <td>423683</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>4</td>
      <td>507696</td>
      <td>3510</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>top</th>
      <td>paradise</td>
      <td>THE BEARER</td>
      <td>MLT</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>350008</td>
      <td>70871</td>
      <td>44916</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">'intermediary'</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>25745</td>
      <td>25744</td>
      <td>23152</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>4</td>
      <td>24621</td>
      <td>285</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>top</th>
      <td>panama</td>
      <td>HUTCHINSON GAYLE A.</td>
      <td>HKG</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>14110</td>
      <td>62</td>
      <td>4895</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">'address'</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>374955</td>
      <td>0.0</td>
      <td>250105</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>4</td>
      <td>0.0</td>
      <td>216</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>top</th>
      <td>paradise</td>
      <td>NaN</td>
      <td>CHN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>223350</td>
      <td>NaN</td>
      <td>31984</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s">'other'</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2919</td>
      <td>2919</td>
      <td>386</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>1</td>
      <td>2912</td>
      <td>63</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>top</th>
      <td>paradise</td>
      <td>ANTAM ENTERPRISES N.V.</td>
      <td>IMN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>2919</td>
      <td>2</td>
      <td>105</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="create-and-study-edges-dataframe">Create and study <em>edges</em> dataframe</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'START_ID'</span><span class="p">,</span> <span class="s">'END_ID'</span><span class="p">,</span> <span class="s">'TYPE'</span><span class="p">,</span> <span class="s">'start_date'</span><span class="p">,</span> <span class="s">'end_date'</span><span class="p">,</span><span class="s">'source'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources_names</span><span class="p">:</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d_clean</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s">'edges'</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">edges</span><span class="p">[</span><span class="s">'start_date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="s">'start_date'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">parse_date</span><span class="p">))</span>
<span class="n">edges</span><span class="p">[</span><span class="s">'end_date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="s">'end_date'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">parse_date</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>18/19/2015
16/20/2013
05152015
05152015
05152015
05152015
05152015
05152015
05152015
05152015
1212012
29/02/2006
29/02/2006
28.02/2014
06/01.2009
25090015
31/02/2013
31/02/2013
31/02/2013
12-112013
284/2015
</code></pre></div></div>

<p>Printed strings are dates that were not read correctly</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">edges</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>START_ID</th>
      <th>END_ID</th>
      <th>TYPE</th>
      <th>start_date</th>
      <th>end_date</th>
      <th>source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3142523.0</td>
      <td>3142523.0</td>
      <td>3142523</td>
      <td>928670</td>
      <td>266893</td>
      <td>3142523</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>1054794.0</td>
      <td>1224551.0</td>
      <td>13</td>
      <td>12353</td>
      <td>8545</td>
      <td>4</td>
    </tr>
    <tr>
      <th>top</th>
      <td>54662.0</td>
      <td>236724.0</td>
      <td>officer_of</td>
      <td>1969-12-31 00:00:00</td>
      <td>2012-09-30 00:00:00</td>
      <td>paradise</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>36373.0</td>
      <td>37338.0</td>
      <td>1667166</td>
      <td>1848</td>
      <td>9663</td>
      <td>1657838</td>
    </tr>
    <tr>
      <th>first</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1960-03-10 00:00:00</td>
      <td>1960-05-30 00:00:00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>last</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2015-12-31 00:00:00</td>
      <td>2015-12-31 00:00:00</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>We see there are <b>13</b> unique kind of edges, they are listed below. In further analysis it will be interesting to study each of them in more depth.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">edges</span><span class="o">.</span><span class="n">TYPE</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array(['same_address_as', 'same_company_as', 'similar_company_as',
       'intermediary_of', 'registered_address', 'same_name_as',
       'same_intermediary_as', 'officer_of', 'probably_same_officer_as',
       'connected_to', 'same_id_as', 'same_as', 'underlying'],
      dtype=object)
</code></pre></div></div>

<h3 id="study-dates">Study dates</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">number_edges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
<span class="n">number_start_date</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">number_end_date</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">pourcentage</span><span class="p">(</span><span class="n">number_start_date</span><span class="o">/</span><span class="n">number_edges</span><span class="p">),</span> <span class="s">"of edges have a start date"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Among those,"</span><span class="p">,</span> <span class="n">pourcentage</span><span class="p">(</span><span class="n">number_end_date</span><span class="o">/</span><span class="p">(</span><span class="n">number_end_date</span><span class="o">+</span><span class="n">number_start_date</span><span class="p">)),</span> <span class="s">"have an end date"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"The first added relation was the"</span><span class="p">,</span> <span class="n">edges</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="nb">min</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">"The last added relation was the"</span><span class="p">,</span> <span class="n">edges</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="nb">max</span><span class="p">())</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1m29.55%[0m of edges have a start date
Among those, [1m22.32%[0m have an end date
The first added relation was the 1960-03-10 00:00:00
The last added relation was the 2015-12-31 00:00:00
</code></pre></div></div>

<h3 id="study-average-and-extreme-values">Study average and extreme values</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">START_ID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">END_ID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>count    1.054794e+06
mean     2.979277e+00
std      6.123411e+01
min      1.000000e+00
25%      1.000000e+00
50%      1.000000e+00
75%      2.000000e+00
max      3.637300e+04
Name: START_ID, dtype: float64 

count    1.224551e+06
mean     2.566266e+00
std      3.778810e+01
min      1.000000e+00
25%      1.000000e+00
50%      1.000000e+00
75%      2.000000e+00
max      3.733800e+04
Name: END_ID, dtype: float64
</code></pre></div></div>

<p>We see that on average <b>2.98</b> edges start with the same node_id, and <b>2.57</b> end with the same node_id</p>

<p>Max number of connections starting from a given node is <b>36373</b>, and <b>37338</b> ending (another node)</p>

<h2 id="study-connection-between-edges-and-nodes">Study connection between edges and nodes</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">id_max_links_start</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">START_ID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">max_links_start</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">START_ID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span>
<span class="n">node_max_links_start</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">id_max_links_start</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">id_max_links_end</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">END_ID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">max_links_end</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">END_ID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="nb">max</span><span class="p">()</span>
<span class="n">node_max_links_end</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">id_max_links_end</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"The Node with the most START edges has"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">max_links_start</span><span class="p">)),</span> <span class="s">"links and is :"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">node_max_links_start</span><span class="p">[[</span><span class="s">'source'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'country_codes'</span><span class="p">]])</span>

<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">The Node with the most END edges has"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">max_links_end</span><span class="p">)),</span> <span class="s">"links and is :"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">node_max_links_end</span><span class="p">[[</span><span class="s">'source'</span><span class="p">,</span> <span class="s">'country_codes'</span><span class="p">]])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The Node with the most START edges has [1m36373[0m links and is :
                source                               name    country_codes
type                                                                      
intermediary  offshore  Portcullis TrustNet (BVI) Limited  THA;VGB;IDN;SGP
officer       offshore  Portcullis TrustNet (BVI) Limited  THA;VGB;IDN;SGP

The Node with the most END edges has [1m37338[0m links and is :
           source country_codes
type                           
address  offshore           VGB
</code></pre></div></div>

<h3 id="study-nodes-that-are-isolated">Study nodes that are isolated</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
<span class="n">linked_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">START_ID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">END_ID</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="n">isolated_nodes</span> <span class="o">=</span> <span class="n">node_ids</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">linked_nodes</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"There are"</span><span class="p">,</span> <span class="n">color</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">isolated_nodes</span><span class="p">))),</span> <span class="s">"isolated nodes (0 edge connecting them)"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are [1m3277[0m isolated nodes (0 edge connecting them)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mask_isolated</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">isolated_nodes</span><span class="p">)</span>
<span class="n">nodes</span><span class="p">[</span><span class="n">mask_isolated</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>name</th>
      <th>country_codes</th>
      <th>jurisdiction</th>
      <th>incorporation_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3277</td>
      <td>3261</td>
      <td>428</td>
      <td>184</td>
      <td>145</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>4</td>
      <td>3233</td>
      <td>73</td>
      <td>3</td>
      <td>109</td>
    </tr>
    <tr>
      <th>top</th>
      <td>paradise</td>
      <td>THE BEARER</td>
      <td>IMN</td>
      <td>KNA</td>
      <td>1980-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>3069</td>
      <td>21</td>
      <td>106</td>
      <td>149</td>
      <td>9</td>
    </tr>
    <tr>
      <th>first</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1980-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>last</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2011-08-05 00:00:00</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="planning">Planning</h2>

<p>We are planning to infer using the edges:</p>
<ul>
  <li>all the jurisdictions some nodes such as <em>officer</em> have links to, in order to see if see if they are connected to accounts in different jurisdictions.</li>
  <li>for <em>entity</em> the country_codes, which would be the country of the people that are connected to this jurisdiction.</li>
</ul>

	    
    </div>
  </div>
</div>


    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <p class="copyright text-muted">
      Pierre Latécoère, Simon Roquette and Yoan Martin
      &nbsp;&bull;&nbsp;
      2018
      
      </p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/ADA_Project_Cobra/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/ADA_Project_Cobra/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/ADA_Project_Cobra/js/main.js"></script>
    
  


  
  </body>
</html>
